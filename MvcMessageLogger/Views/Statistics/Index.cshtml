@model IEnumerable<MvcMessageLogger.Models.User>
@{
    var sortedDict = ViewData["UsersOrderedByMessageCount"] as IEnumerable<KeyValuePair<string, int>>;
    var hourly = ViewData["HourOfMostMessages"] as Dictionary<string, int>;
    var overallByUser = ViewData["MostCommonWord"] as Dictionary<string, int>;
    var overall = ViewData["MostCommonWordOverall"] as Dictionary<string, int>;
    var allUsernames = ViewData["AllUsernames"] as List<string>;
    var searched = ViewData["SearchUsername"] as User;
}

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>
<body>
    <div class="text-center"><h1>Statistics</h1></div>
    <hr/>
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <h2 class="bg-primary text-white rounded p-2">Users Ordered by Message Count</h2>
                <ul class="list-group">
                @foreach (var kvpair in sortedDict)
                {
                        <li class="list-group-item"><strong>@kvpair.Key:</strong> @kvpair.Value</li>
                }
                </ul>
            </div> <!-- End Message Count column -->
            <div class="col-md-4">
                <h2 class="bg-primary text-white rounded p-2">Most Messages by Hour</h2>
                <ul class="list-group">
                @foreach (var kvpair in hourly)
                {
                        <li class="list-group-item"><strong>@kvpair.Key:</strong> @kvpair.Value</li>
                }
                </ul>
            </div> <!-- End Most Messages column -->
            <div class="col-md-4">
                
                @if (@ViewData["SearchUsername"] != null)
                {
                    <h2 class="bg-primary text-white rounded p-2">Most Common Word By @searched.Username</h2>
                    <ul class="list-group">
                    @foreach (var kvpair in overallByUser.OrderByDescending(kvp => kvp.Value))
                    {
                            <li class="list-group-item"><strong>@kvpair.Key:</strong> @kvpair.Value</li>
                    }
                    </ul>
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            @searched.Username
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item dropdown-header" href="/Statistics">All</a></li>
                            @foreach (var username in allUsernames)
                            {
                                <li><a class="dropdown-item" href="/Statistics?username=@username">@username</a></li>
                            }
                        </ul>
                    </div>
                }
                @if (@ViewData["SearchUsername"] == null)
                {
                    <h2 class="bg-primary text-white rounded p-2">Most Common Word Overall</h2>
                    <ul class="list-group">
                        @foreach (var kvpair in overall.OrderByDescending(kvp => kvp.Value))
                    {
                            <li class="list-group-item"><strong>@kvpair.Key:</strong> @kvpair.Value</li>
                    }
                    </ul>

                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Select User
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item dropdown-header" href="/Statistics">All</a></li>
                            @foreach (var username in allUsernames)
                            {
                                <li><a class="dropdown-item" href="/Statistics?username=@username">@username</a></li>
                            }
                        </ul>
                    </div>
                }
            </div> <!-- End Common Word column -->
        </div> <!-- End row -->
    </div> <!-- End container -->
</body>

